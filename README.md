# Severomorets

Система голосовых звонков с мастер и slave приложениями.

## Архитектура

- **Мастер приложение (APK)** - основное приложение, видит всех подключенных пользователей
- **Веб-версия** - позволяет звонить мастеру через браузер
- **Slave приложения (APK)** - индивидуальные приложения для каждого пользователя, видят только мастера

## Установка

```bash
npm install
```

## Запуск сервера

```bash
npm run server
```

Сервер будет доступен на `http://localhost:3000`

## Сборка приложений

### Мастер приложение

```bash
npm run build:master
```

APK будет в `app-master-debug.apk` или `app-master-release.apk`

### Slave приложение

1. Создайте файл `slave-config.json` на основе `slave-config.json.example`:
```json
{
  "deviceId": "unique-device-id-123",
  "userName": "Имя пользователя"
}
```

2. Соберите приложение:
```bash
npm run build:slave
```

APK будет в `app-slave-debug.apk` или `app-slave-release.apk`

## Структура проекта

```
severomorets/
├── server/
│   └── index.mjs          # Сервер с Socket.IO и JSON БД
├── www/
│   ├── index.html         # Веб-версия
│   ├── cordova.html       # Cordova приложение (Master/Slave)
│   ├── css/
│   └── js/
│       ├── app.js         # Веб-версия логика
│       └── cordova-app.js # Cordova логика
├── data/
│   └── users.json         # JSON база данных (создается автоматически)
├── build-script.js        # Скрипт сборки APK
└── slave-config.json.example # Пример конфигурации slave
```

## Использование

### Мастер

1. Установите мастер APK на устройство
2. Запустите приложение
3. Введите имя и подключитесь
4. Вы увидите всех подключенных пользователей
5. Можете звонить любому пользователю

### Веб-версия

1. Откройте `http://localhost:3000` в браузере
2. Введите имя и подключитесь
3. Нажмите "Позвонить мастеру"

### Slave

1. Создайте `slave-config.json` с уникальным deviceId
2. Соберите APK: `npm run build:slave`
3. Установите на устройство
4. Запустите приложение
5. Вы увидите только мастера
6. Можете звонить мастеру

## База данных

База данных хранится в `data/users.json` в формате:

```json
{
  "users": [
    {
      "id": 1,
      "role": "master",
      "deviceId": "device-123",
      "name": "Мастер",
      "online": true,
      "createdAt": "2024-01-01T00:00:00.000Z",
      "lastSeen": "2024-01-01T00:00:00.000Z"
    }
  ],
  "lastId": 1
}
```

## Переменные окружения

- `PORT` - порт сервера (по умолчанию: 3000)
- `HOST` - хост сервера (по умолчанию: 0.0.0.0)
- `CORS_ORIGIN` - разрешенные источники CORS (по умолчанию: *)
